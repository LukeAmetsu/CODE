<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ASCE Project Geometry Definition</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script>
        (function() {
            const isDark = localStorage.getItem('color-theme') === 'dark' || (!('color-theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches);
            document.documentElement.classList.toggle('dark', isDark);
        })();
    </script>
    <link rel="stylesheet" href="../styles.min.css">
    <script src="../js/template.js" defer></script>
    <script src="../js/shared-utils.js" defer></script>
    <script src="project_definition.js" defer></script>
</head>
<body class="bg-gray-50 text-gray-800 dark:bg-gray-900 dark:text-gray-300">

    <div class="container mx-auto p-4 md:p-8 max-w-7xl">
        <div id="header-placeholder"></div>

        <main id="project-definition-form">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <div>
                    <div class="form-section">
                        <h2>General Project Parameters</h2>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label for="asce_standard" class="block text-sm font-medium mb-1">ASCE Standard</label>
                                <select id="asce_standard">
                                    <option value="ASCE 7-16" selected>ASCE 7-16</option>
                                    <option value="ASCE 7-22">ASCE 7-22</option>
                                </select>
                            </div>
                            <div>
                                <label for="risk_category" class="block text-sm font-medium mb-1">Risk Category</label>
                                <select id="risk_category">
                                    <option value="I">I</option>
                                    <option value="II" selected>II</option>
                                    <option value="III">III</option>
                                    <option value="IV">IV</option>
                                </select>
                            </div>
                             <div>
                                <label for="jurisdiction" class="block text-sm font-medium mb-1">Jurisdiction</label>
                                <select id="jurisdiction">
                                    <option value="ASCE 7" selected>ASCE 7</option>
                                    <option value="NYCBC 2022">NYCBC 2022</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="form-section">
                        <h2>Site & Environmental Loads</h2>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label for="exposure_category" class="block text-sm font-medium mb-1">Exposure Category</label>
                                <select id="exposure_category">
                                    <option value="B">B</option>
                                    <option value="C" selected>C</option>
                                    <option value="D">D</option>
                                </select>
                            </div>
                            <div>
                                <label for="topographic_factor_Kzt" class="block text-sm font-medium mb-1">Topo. Factor (Kzt)</label>
                                <input type="number" id="topographic_factor_Kzt" value="1">
                            </div>
                            <div>
                                <label for="basic_wind_speed" class="block text-sm font-medium mb-1">Basic Wind Speed (V)</label>
                                <input type="number" id="basic_wind_speed" value="115">
                            </div>
                            <div>
                                <label for="ground_snow_load" class="block text-sm font-medium mb-1">Ground Snow Load (pg)</label>
                                <input type="number" id="ground_snow_load" value="25">
                            </div>
                             <div>
                                <label for="rain_intensity" class="block text-sm font-medium mb-1">Rainfall Intensity (i)</label>
                                <input type="number" id="rain_intensity" value="4.0">
                            </div>
                        </div>
                    </div>

                    <div class="form-section">
                        <h2>Building Geometry Coordinates</h2>
                        <p class="text-xs mb-4">Define the building outline using X and Y points. The origin (0,0) is at the ground level of the leftmost point.</p>
                        
                        <div class="mt-4">
                            <label class="block text-sm font-medium mb-1">Elevation Coordinates (Length Profile)</label>
                            <div id="elevation-coords-container" class="space-y-2 p-2 border rounded-md dark:border-gray-600 bg-gray-50 dark:bg-gray-900/50">
                                <div class="grid grid-cols-[1fr_1fr_auto] gap-2 text-xs font-semibold text-gray-500 dark:text-gray-400">
                                    <span>X</span>
                                    <span>Y</span>
                                    <span class="w-8"></span>
                                </div>
                            </div>
                            <button id="add-elevation-point-btn" class="mt-2 text-xs bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 px-3 py-1 rounded">+ Add Point</button>
                        </div>
                        
                        <div class="mt-6">
                            <label class="block text-sm font-medium mb-1">Section Coordinates (Width Profile)</label>
                            <div id="section-coords-container" class="space-y-2 p-2 border rounded-md dark:border-gray-600 bg-gray-50 dark:bg-gray-900/50">
                                 <div class="grid grid-cols-[1fr_1fr_auto] gap-2 text-xs font-semibold text-gray-500 dark:text-gray-400">
                                    <span>X</span>
                                    <span>Y</span>
                                    <span class="w-8"></span>
                                </div>
                            </div>
                            <button id="add-section-point-btn" class="mt-2 text-xs bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 px-3 py-1 rounded">+ Add Point</button>
                        </div>
                    </div>

                    <div class="form-section">
                        <h2>Site & Project Parameters</h2>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label for="design_method" class="block text-sm font-medium mb-1">Design Method</label>
                                <select id="design_method">
                                    <option value="ASD" selected>ASD</option>
                                    <option value="LRFD">LRFD</option>
                                </select>
                            </div>
                            <div>
                                <label for="ground_elevation" class="block text-sm font-medium mb-1">Ground Elevation</label>
                                <input type="number" id="ground_elevation" value="0">
                            </div>
                            <div>
                                <label for="effective_wind_area" class="block text-sm font-medium mb-1">Effective Wind Area (C&C)</label>
                                <input type="number" id="effective_wind_area" value="10">
                            </div>
                             <div>
                                <label for="enclosure_classification" class="block text-sm font-medium mb-1">Enclosure Class.</label>
                                <select id="enclosure_classification">
                                    <option value="Enclosed" selected>Enclosed</option>
                                    <option value="Partially Enclosed">Partially Enclosed</option>
                                </select>
                            </div>
                            <div>
                                <label for="roof_type_manual" class="block text-sm font-medium mb-1">Roof Type (Manual Override)</label>
                                <select id="roof_type_manual">
                                    <option value="auto" selected>Auto-Detect</option>
                                    <option value="flat">Flat</option>
                                    <option value="gable">Gable</option>
                                    <option value="hip">Hip</option>
                                    <option value="monoslope">Monoslope</option>
                                    <option value="sawtooth">Sawtooth</option>
                                </select>
                            </div>
                             <div>
                                <label for="temporary_construction" class="block text-sm font-medium mb-1">Temporary Construction?</label>
                                <select id="temporary_construction">
                                    <option value="No" selected>No</option>
                                    <option value="Yes">Yes</option>
                                </select>
                            </div>
                        </div>
                    </div>
                     <div class="mt-8 flex justify-center">
                        <button id="save-project-btn" class="bg-blue-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-blue-700">
                            Save Geometry & Proceed
                        </button>
                    </div>
                </div>

                <div>
                    <div class="sticky top-8">
                        <div class="form-section">
                            <h2>Geometry Visualization & Data</h2>
                            <div class="grid grid-cols-1 gap-4">
                                <div class="diagram">
                                    <h4 class="text-center font-semibold text-sm mb-2">Elevation View</h4>
                                    <canvas id="elevation-canvas" height="200"></canvas>
                                </div>
                                <div class="diagram">
                                    <h4 class="text-center font-semibold text-sm mb-2">Section View</h4>
                                    <canvas id="section-canvas" height="200"></canvas>
                                </div>
                            </div>
                            <div id="calculated-data" class="mt-4 text-sm space-y-2">
                                </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <div id="feedback-message" class="text-center mt-4 text-sm h-5"></div>
        <div id="footer-placeholder"></div>
    </div>
</body>
</html>